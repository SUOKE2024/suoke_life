# 索克生活 A2A 智能体系统

## 🚀 项目简介

索克生活 A2A 智能体系统是基于 Google Agent-to-Agent (A2A) 协议构建的现代化健康管理平台。该系统将索克生活项目的四大智能体（小艾、小克、老克、索儿）升级为支持标准化 A2A 协议的智能体网络，实现了分布式协作、实时通信和可视化监控。

## 🏗️ 系统架构

### 四大智能体

1. **小艾智能体 (XiaoaiA2AAgent)**
   - 🎯 **职责**: 用户交互、四诊协调、多模态输入处理
   - 🛠️ **核心技能**:
     - 四诊协调 (望、闻、问、切)
     - 多模态输入处理 (语音、图像、文本)
     - 健康档案查询
     - 语音交互
     - 无障碍支持

2. **小克智能体 (XiaokeA2AAgent)**
   - 🎯 **职责**: 医疗资源管理、农产品定制
   - 🛠️ **核心技能**:
     - 医疗资源调度
     - 预约管理
     - 农产品定制
     - 产品溯源
     - 订阅管理

3. **老克智能体 (LaokeA2AAgent)**
   - 🎯 **职责**: 知识传播、社区管理
   - 🛠️ **核心技能**:
     - 知识内容管理
     - 学习路径规划
     - 社区内容管理
     - 中医知识问答
     - 内容推荐

4. **索儿智能体 (SoerA2AAgent)**
   - 🎯 **职责**: 健康管理引擎
   - 🛠️ **核心技能**:
     - 个性化健康计划生成
     - 传感器数据分析
     - 情绪识别与干预
     - 营养分析与建议
     - 健康陪伴与支持

### 网络架构

```
┌─────────────────────────────────────────────────────────────┐
│                    A2A 智能体网络管理器                      │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐        │
│  │  小艾   │  │  小克   │  │  老克   │  │  索儿   │        │
│  │ 智能体  │  │ 智能体  │  │ 智能体  │  │ 智能体  │        │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘        │
├─────────────────────────────────────────────────────────────┤
│                      工作流引擎                             │
│  • 健康咨询工作流                                           │
│  • 农产品定制工作流                                         │
│  • 健康数据分析工作流                                       │
├─────────────────────────────────────────────────────────────┤
│                    监控与管理系统                           │
│  • 实时性能监控                                             │
│  • 健康状态检查                                             │
│  • Web 可视化仪表板                                         │
└─────────────────────────────────────────────────────────────┘
```

## 🔧 安装与配置

### 环境要求

- Python 3.8+
- 已安装的依赖包:
  - `python-a2a`
  - `flask`
  - `flask-socketio`
  - `grpcio`
  - `motor`
  - `pymongo`

### 安装步骤

1. **安装依赖**:
   ```bash
   cd services/agent-services
   pip install python-a2a flask flask-socketio grpcio motor pymongo
   ```

2. **验证安装**:
   ```bash
   python run_a2a_system.py status
   ```

## 🚀 使用指南

### 统一启动器

使用 `run_a2a_system.py` 脚本可以启动系统的不同模式：

```bash
# 查看帮助
python run_a2a_system.py --help

# 运行演示模式
python run_a2a_system.py demo

# 启动监控器
python run_a2a_system.py monitor

# 启动 Web 仪表板
python run_a2a_system.py dashboard

# 启动交互模式
python run_a2a_system.py interactive

# 查看系统状态
python run_a2a_system.py status
```

### 运行模式详解

#### 1. 演示模式 (Demo)

运行预设的演示请求，展示智能体协作能力：

```bash
python run_a2a_system.py demo
```

**功能**:
- 自动运行多个预设的健康咨询场景
- 展示四大智能体的协作流程
- 显示工作流执行结果

#### 2. 监控器模式 (Monitor)

启动命令行监控器，实时监控网络状态：

```bash
python run_a2a_system.py monitor
```

**功能**:
- 实时监控智能体状态
- 性能指标收集和分析
- 健康检查和问题诊断
- 指标数据导出

#### 3. Web 仪表板模式 (Dashboard)

启动可视化监控仪表板：

```bash
# 默认端口 5000
python run_a2a_system.py dashboard

# 自定义端口
python run_a2a_system.py dashboard --port 8080

# 启用调试模式
python run_a2a_system.py dashboard --debug
```

**功能**:
- 实时可视化监控界面
- 智能体状态和性能图表
- 交互式健康检查和性能测试
- 系统日志实时显示

**访问地址**: http://127.0.0.1:5000

#### 4. 交互模式 (Interactive)

启动交互式对话模式：

```bash
python run_a2a_system.py interactive
```

**功能**:
- 直接与智能体网络对话
- 实时处理用户输入
- 支持自然语言交互

#### 5. 状态查看 (Status)

查看系统当前状态：

```bash
python run_a2a_system.py status
```

**功能**:
- 显示智能体配置信息
- 列出可用工作流
- 系统健康状态概览

## 🔄 工作流系统

### 预设工作流

#### 1. 健康咨询工作流

**流程**:
1. 小艾接收用户咨询
2. 小艾路由诊断请求
3. 小克进行中医诊断 (条件执行)
4. 索儿制定健康计划
5. 老克提供知识支持
6. 小艾综合回复

**使用场景**: 用户健康问题咨询、体质分析、健康建议

#### 2. 农产品定制工作流

**流程**:
1. 小艾分析定制需求
2. 小克评估用户体质
3. 索儿分析营养需求
4. 小克推荐农产品
5. 老克提供食疗指导

**使用场景**: 个性化农产品推荐、食疗方案定制

#### 3. 健康数据分析工作流

**流程**:
1. 小艾收集健康数据
2. 索儿分析传感器数据
3. 小克中医解读
4. 索儿趋势预测
5. 老克知识关联
6. 小艾生成综合报告

**使用场景**: 健康数据分析、趋势预测、风险评估

## 📊 监控系统

### 监控指标

#### 网络级指标
- 总智能体数量
- 活跃智能体数量
- 网络运行时间
- 总请求数
- 成功率
- 平均响应时间
- 并发请求峰值

#### 智能体级指标
- 智能体状态 (活跃/非活跃)
- 处理请求总数
- 成功请求数
- 失败请求数
- 平均响应时间
- 最后活动时间
- 运行时间

### 健康检查

系统自动进行健康检查，监控以下指标：

- **错误率**: 超过 10% 触发警告
- **响应时间**: 超过 5 秒触发警告
- **智能体状态**: 非活跃状态触发严重警告
- **网络成功率**: 低于 90% 触发警告

### 性能测试

支持自动化性能测试：

- 单智能体性能测试
- 网络整体性能测试
- 并发处理能力测试
- 响应时间基准测试

## 🔧 配置选项

### 网络配置

```python
config = {
    "xiaoai": {
        "max_concurrent_requests": 10,
        "timeout": 30
    },
    "xiaoke": {
        "max_concurrent_requests": 10,
        "timeout": 30
    },
    "laoke": {
        "max_concurrent_requests": 10,
        "timeout": 30
    },
    "soer": {
        "max_concurrent_requests": 10,
        "timeout": 30
    }
}
```

### 监控配置

```python
monitor_config = {
    "metrics_interval": 5,  # 指标收集间隔 (秒)
    "history_limit": 100,   # 历史记录限制
    "health_check_interval": 60,  # 健康检查间隔 (秒)
    "export_format": "json"  # 导出格式
}
```

## 🐛 故障排除

### 常见问题

#### 1. 导入错误

**问题**: `ModuleNotFoundError: No module named 'python_a2a'`

**解决方案**:
```bash
pip install python-a2a
```

#### 2. 智能体启动失败

**问题**: 智能体无法启动或注册失败

**解决方案**:
1. 检查依赖是否完整安装
2. 验证配置文件格式
3. 查看详细错误日志

#### 3. Web 仪表板无法访问

**问题**: 浏览器无法访问仪表板

**解决方案**:
1. 确认端口未被占用
2. 检查防火墙设置
3. 尝试使用 `127.0.0.1` 而不是 `localhost`

#### 4. 性能问题

**问题**: 响应时间过长或超时

**解决方案**:
1. 检查系统资源使用情况
2. 调整并发请求限制
3. 优化智能体处理逻辑

### 调试模式

启用调试模式获取详细日志：

```bash
python run_a2a_system.py dashboard --debug --log-level DEBUG
```

## 📈 性能优化

### 建议配置

#### 生产环境
- 增加并发请求限制
- 启用请求缓存
- 配置负载均衡
- 设置监控告警

#### 开发环境
- 启用详细日志
- 降低超时时间
- 启用调试模式

### 扩展性

系统支持以下扩展：

1. **新增智能体**: 实现 A2A 协议接口
2. **自定义工作流**: 定义新的协作流程
3. **监控插件**: 添加自定义监控指标
4. **存储后端**: 支持多种数据存储方案

## 🤝 贡献指南

### 开发环境设置

1. 克隆项目
2. 安装依赖
3. 运行测试
4. 提交 Pull Request

### 代码规范

- 遵循 PEP 8 代码风格
- 添加完整的文档字符串
- 编写单元测试
- 使用类型注解

## 📄 许可证

本项目采用 MIT 许可证，详见 LICENSE 文件。

## 🆘 支持

如有问题或建议，请：

1. 查看本文档的故障排除部分
2. 提交 GitHub Issue
3. 联系开发团队

---

**索克生活 A2A 智能体系统** - 让健康管理更智能、更协作、更高效！ 