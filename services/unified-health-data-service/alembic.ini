# Alembic配置文件

[alembic]
# 迁移脚本目录路径
script_location = migrations

# 模板文件，用于生成迁移脚本
file_template = %%(year)d%%(month).2d%%(day).2d_%%(hour).2d%%(minute).2d_%%(rev)s_%%(slug)s

# 系统路径，用于导入模块
prepend_sys_path = .

# 时区设置
timezone = UTC

# 是否截断长的SQL语句
truncate_slug_length = 40

# 版本路径模式
version_path_separator = os

# 版本表名
version_table = alembic_version

# 版本表模式
version_table_schema = public

# 数据库连接URL（从环境变量获取）
sqlalchemy.url = postgresql://%(DB_USER)s:%(DB_PASSWORD)s@%(DB_HOST)s:%(DB_PORT)s/%(DB_NAME)s

# 数据库连接池设置
sqlalchemy.pool_pre_ping = true
sqlalchemy.pool_recycle = 300

# 日志配置
[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = WARN
handlers = console
qualname =

[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy.engine

[logger_alembic]
level = INFO
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S

# 自定义配置段
[unified_health_data_service]
# 服务特定配置
service_name = unified-health-data-service
version = 1.0.0

# 数据库配置
[database]
# PostgreSQL配置
postgres_host = ${DB_HOST:localhost}
postgres_port = ${DB_PORT:5432}
postgres_user = ${DB_USER:suoke_user}
postgres_password = ${DB_PASSWORD:suoke_password}
postgres_database = ${DB_NAME:suoke_health_data}

# Redis配置
redis_host = ${REDIS_HOST:localhost}
redis_port = ${REDIS_PORT:6379}
redis_password = ${REDIS_PASSWORD:}
redis_database = ${REDIS_DB:0}

# MongoDB配置
mongo_host = ${MONGO_HOST:localhost}
mongo_port = ${MONGO_PORT:27017}
mongo_user = ${MONGO_USER:}
mongo_password = ${MONGO_PASSWORD:}
mongo_database = ${MONGO_DB:suoke_health_data}

# 迁移配置
[migration]
# 是否自动生成迁移
auto_generate = true

# 比较类型
compare_type = true

# 比较服务器默认值
compare_server_default = true

# 包含的表模式
include_schemas = public

# 排除的表
exclude_tables = 

# 包含的对象类型
include_object_types = table,index,column

# 渲染项目
render_item = 

# 目标元数据
target_metadata = 

# 环境配置
[environment]
# 开发环境
development.sqlalchemy.url = postgresql://suoke_user:suoke_password@localhost:5432/suoke_health_data_dev

# 测试环境
testing.sqlalchemy.url = postgresql://suoke_user:suoke_password@localhost:5432/suoke_health_data_test

# 生产环境
production.sqlalchemy.url = postgresql://suoke_user:suoke_password@localhost:5432/suoke_health_data_prod

# 性能配置
[performance]
# 连接池大小
pool_size = 20
max_overflow = 30
pool_timeout = 30
pool_recycle = 3600

# 查询超时
query_timeout = 30

# 批量操作大小
batch_size = 1000

# 安全配置
[security]
# SSL模式
ssl_mode = prefer

# SSL证书路径
ssl_cert = 
ssl_key = 
ssl_ca = 

# 连接加密
encrypt_connection = true

# 监控配置
[monitoring]
# 启用查询日志
enable_query_log = false

# 慢查询阈值（秒）
slow_query_threshold = 1.0

# 启用性能监控
enable_performance_monitoring = true

# 指标收集间隔（秒）
metrics_interval = 60