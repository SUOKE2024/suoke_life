# å¤šæ¨¡æ€RAGå¢å¼ºç³»ç»Ÿ

æœ¬ç³»ç»Ÿä¸ºç´¢å…‹ç”Ÿæ´»å¹³å°æä¾›äº†å®Œæ•´çš„å¤šæ¨¡æ€æ£€ç´¢å¢å¼ºç”ŸæˆåŠŸèƒ½ï¼Œä¸“é—¨é’ˆå¯¹ä¸­åŒ»è¯Šæ–­åœºæ™¯è¿›è¡Œä¼˜åŒ–ã€‚ç³»ç»Ÿæ”¯æŒæ–‡æœ¬ã€èˆŒè±¡ã€è„‰è±¡ç­‰å¤šç§æ¨¡æ€çš„æ•°æ®èåˆå’Œæ™ºèƒ½åˆ†æã€‚

## ğŸŒŸ æ ¸å¿ƒç‰¹æ€§

- **å¤šæ¨¡æ€æ•°æ®ç¼–ç **ï¼šæ”¯æŒæ–‡æœ¬ã€èˆŒè±¡å›¾åƒã€è„‰è±¡ä¿¡å·çš„æ™ºèƒ½ç¼–ç 
- **è·¨æ¨¡æ€åµŒå…¥èåˆ**ï¼šä½¿ç”¨æ³¨æ„åŠ›æœºåˆ¶èåˆä¸åŒæ¨¡æ€çš„ç‰¹å¾å‘é‡
- **ä¸­åŒ»è¯Šæ–­ä¼˜åŒ–**ï¼šé’ˆå¯¹ä¸­åŒ»"æœ›é—»é—®åˆ‡"å››è¯Šåˆå‚è¿›è¡Œç‰¹åˆ«ä¼˜åŒ–
- **æ™ºèƒ½æ£€ç´¢ç”Ÿæˆ**ï¼šåŸºäºèåˆå‘é‡è¿›è¡Œç²¾å‡†æ£€ç´¢å’Œä¸“ä¸šå›ç­”ç”Ÿæˆ
- **ç­–ç•¥å¯é…ç½®**ï¼šæ”¯æŒå¤šç§èåˆç­–ç•¥ï¼Œé€‚åº”ä¸åŒè¯Šæ–­åœºæ™¯

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ–‡æœ¬ç¼–ç å™¨    â”‚    â”‚   èˆŒè±¡ç¼–ç å™¨    â”‚    â”‚   è„‰è±¡ç¼–ç å™¨    â”‚
â”‚  TextEncoder    â”‚    â”‚  TongueEncoder  â”‚    â”‚  PulseEncoder   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚                       â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  å¤šæ¨¡æ€èåˆå™¨   â”‚
                    â”‚ EmbeddingFusion â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å‘é‡æ£€ç´¢å™¨    â”‚
                    â”‚  VectorSearch   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   å›ç­”ç”Ÿæˆå™¨    â”‚
                    â”‚ AnswerGenerator â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨

```typescript
import { 
  createConfiguredMultimodalRAGService,
  FUSION_STRATEGIES,
  MODALITY_TYPES 
} from './src/core/multimodal';

// åˆ›å»ºæœåŠ¡å®ä¾‹
const ragService = await createConfiguredMultimodalRAGService(
  vectorDatabase,  // ä½ çš„å‘é‡æ•°æ®åº“å®ä¾‹
  languageModel,   // ä½ çš„è¯­è¨€æ¨¡å‹å®ä¾‹
  {
    defaultStrategy: FUSION_STRATEGIES.TCM_DIAGNOSIS_ENHANCED,
    defaultTopK: 5,
    defaultThreshold: 0.7
  }
);

// æ‰§è¡Œå¤šæ¨¡æ€æŸ¥è¯¢
const response = await ragService.query({
  text: 'æ‚£è€…èˆŒè´¨çº¢ï¼Œè‹”è–„é»„ï¼Œè„‰æ•°ï¼Œè¯·åˆ†æç—…æƒ…',
  tongueImage: tongueImageData,
  pulseSignal: pulseSignalArray,
  strategy: FUSION_STRATEGIES.TCM_DIAGNOSIS_ENHANCED
});

console.log('è¯Šæ–­ç»“æœ:', response.answer);
console.log('ç½®ä¿¡åº¦:', response.confidence);
console.log('å‚è€ƒæ–‡çŒ®:', response.sources);
```

### 2. æ·»åŠ åŒ»å­¦çŸ¥è¯†åº“

```typescript
// æ‰¹é‡æ·»åŠ ä¸­åŒ»çŸ¥è¯†æ–‡æ¡£
await ragService.addDocuments([
  {
    id: 'tcm_doc_1',
    content: 'èˆŒçº¢è‹”é»„ï¼Œè„‰æ•°æœ‰åŠ›ï¼Œä¸ºå®çƒ­è¯ã€‚æ²»å®œæ¸…çƒ­æ³»ç«ï¼Œæ–¹ç”¨ç™½è™æ±¤ã€‚',
    modality: MODALITY_TYPES.TEXT,
    metadata: { 
      category: 'ä¸­åŒ»è¯Šæ–­',
      syndrome: 'å®çƒ­è¯',
      prescription: 'ç™½è™æ±¤'
    }
  },
  {
    id: 'tcm_doc_2',
    content: 'èˆŒæ·¡è‹”ç™½ï¼Œè„‰æ²‰ç»†ï¼Œä¸ºè™šå¯’è¯ã€‚æ²»å®œæ¸©é˜³è¡¥æ°”ï¼Œæ–¹ç”¨å››å›å­æ±¤ã€‚',
    modality: MODALITY_TYPES.TEXT,
    metadata: { 
      category: 'ä¸­åŒ»è¯Šæ–­',
      syndrome: 'è™šå¯’è¯',
      prescription: 'å››å›å­æ±¤'
    }
  }
]);
```

### 3. è‡ªå®šä¹‰èåˆç­–ç•¥

```typescript
import { FusionStrategy } from './src/core/multimodal';

// åˆ›å»ºè‡ªå®šä¹‰ç­–ç•¥
const customStrategy: FusionStrategy = {
  name: 'pediatric_diagnosis',
  weights: {
    [MODALITY_TYPES.TEXT]: 0.5,      // å„¿ç§‘é‡è§†ç—‡çŠ¶æè¿°
    [MODALITY_TYPES.TONGUE]: 0.3,    // èˆŒè±¡å‚è€ƒ
    [MODALITY_TYPES.PULSE]: 0.2,     // è„‰è±¡å‚è€ƒï¼ˆå„¿ç«¥è„‰è±¡ç‰¹æ®Šï¼‰
    [MODALITY_TYPES.AUDIO]: 0.0,
    [MODALITY_TYPES.IMAGE]: 0.0
  },
  method: 'weighted_sum',
  parameters: {
    normalization: 'l2'
  }
};

// æ·»åŠ åˆ°æœåŠ¡
ragService.addFusionStrategy(customStrategy);
```

## ğŸ“Š æ”¯æŒçš„æ¨¡æ€ç±»å‹

### 1. æ–‡æœ¬æ¨¡æ€ (TEXT)
- **è¾“å…¥æ ¼å¼**ï¼šå­—ç¬¦ä¸²
- **åº”ç”¨åœºæ™¯**ï¼šç—‡çŠ¶æè¿°ã€ç—…å²è®°å½•ã€é—®è¯Šä¿¡æ¯
- **ç¼–ç ç»´åº¦**ï¼š768ç»´
- **ç‰¹å¾æå–**ï¼šåŸºäºBERTç±»æ¨¡å‹çš„è¯­ä¹‰ç¼–ç 

```typescript
const textQuery = {
  text: 'æ‚£è€…ä¸»è¯‰å¤´ç—›ã€å¤±çœ ã€å¿ƒçƒ¦æ˜“æ€’',
  modality: MODALITY_TYPES.TEXT
};
```

### 2. èˆŒè±¡æ¨¡æ€ (TONGUE)
- **è¾“å…¥æ ¼å¼**ï¼šImageData æˆ– base64å­—ç¬¦ä¸²
- **åº”ç”¨åœºæ™¯**ï¼šèˆŒè´¨ã€èˆŒè‹”ã€èˆŒå½¢åˆ†æ
- **ç¼–ç ç»´åº¦**ï¼š512ç»´
- **ç‰¹å¾æå–**ï¼šCNNæå–é¢œè‰²ã€çº¹ç†ã€å½¢çŠ¶ç‰¹å¾

```typescript
const tongueQuery = {
  tongueImage: 'data:image/jpeg;base64,/9j/4AAQ...',
  modality: MODALITY_TYPES.TONGUE
};
```

### 3. è„‰è±¡æ¨¡æ€ (PULSE)
- **è¾“å…¥æ ¼å¼**ï¼šnumber[] æˆ– Float32Array
- **åº”ç”¨åœºæ™¯**ï¼šè„‰ç‡ã€è„‰å¾‹ã€è„‰åŠ›åˆ†æ
- **ç¼–ç ç»´åº¦**ï¼š256ç»´
- **ç‰¹å¾æå–**ï¼šä¿¡å·å¤„ç†æå–æ—¶åŸŸé¢‘åŸŸç‰¹å¾

```typescript
const pulseQuery = {
  pulseSignal: [0.1, 0.3, 0.8, 0.5, ...], // è„‰è±¡ä¿¡å·æ•°ç»„
  modality: MODALITY_TYPES.PULSE
};
```

## ğŸ¯ èåˆç­–ç•¥è¯¦è§£

### 1. ä¸­åŒ»è¯Šæ–­ç­–ç•¥ (tcm_diagnosis_enhanced)
- **é€‚ç”¨åœºæ™¯**ï¼šç»¼åˆæ€§ä¸­åŒ»è¯Šæ–­
- **æƒé‡åˆ†é…**ï¼šæ–‡æœ¬25%ï¼ŒèˆŒè±¡40%ï¼Œè„‰è±¡35%
- **èåˆæ–¹æ³•**ï¼šè·¨æ¨¡æ€æ³¨æ„åŠ›æœºåˆ¶
- **ç‰¹ç‚¹**ï¼šé‡è§†èˆŒè±¡å’Œè„‰è±¡çš„å®¢è§‚ä¿¡æ¯

### 2. ç—‡çŠ¶åˆ†æç­–ç•¥ (symptom_analysis)
- **é€‚ç”¨åœºæ™¯**ï¼šåŸºäºç—‡çŠ¶çš„åˆæ­¥åˆ†æ
- **æƒé‡åˆ†é…**ï¼šæ–‡æœ¬60%ï¼ŒèˆŒè±¡20%ï¼Œè„‰è±¡20%
- **èåˆæ–¹æ³•**ï¼šåŠ æƒæ±‚å’Œ
- **ç‰¹ç‚¹**ï¼šä»¥æ–‡æœ¬ç—‡çŠ¶æè¿°ä¸ºä¸»å¯¼

### 3. ä½“è´¨è¾¨è¯†ç­–ç•¥ (constitution_identification)
- **é€‚ç”¨åœºæ™¯**ï¼šä¸­åŒ»ä½“è´¨ç±»å‹åˆ¤æ–­
- **æƒé‡åˆ†é…**ï¼šæ–‡æœ¬30%ï¼ŒèˆŒè±¡35%ï¼Œè„‰è±¡35%
- **èåˆæ–¹æ³•**ï¼šå¤šå¤´æ³¨æ„åŠ›
- **ç‰¹ç‚¹**ï¼šå¹³è¡¡å„æ¨¡æ€ä¿¡æ¯ï¼Œé€‚åˆä½“è´¨åˆ†æ

## ğŸ”§ é«˜çº§é…ç½®

### 1. ç¼–ç å™¨é…ç½®

```typescript
const config = {
  encoders: {
    text: {
      dimension: 768,
      maxLength: 512,
      device: 'gpu'
    },
    tongue: {
      dimension: 512,
      batchSize: 16
    },
    pulse: {
      dimension: 256,
      batchSize: 64
    }
  }
};
```

### 2. ç¼“å­˜é…ç½®

```typescript
const config = {
  cacheSize: 1000,      // ç¼“å­˜æ¡ç›®æ•°
  cacheTTL: 3600000,    // ç¼“å­˜æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
  defaultTopK: 5,       // é»˜è®¤æ£€ç´¢æ•°é‡
  defaultThreshold: 0.7 // é»˜è®¤ç›¸ä¼¼åº¦é˜ˆå€¼
};
```

### 3. æ€§èƒ½é…ç½®

```typescript
const config = {
  batchSize: 32,        // æ‰¹å¤„ç†å¤§å°
  maxConcurrency: 4     // æœ€å¤§å¹¶å‘æ•°
};
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å‘é‡ç»´åº¦é€‰æ‹©
- **æ–‡æœ¬**ï¼š768ç»´ï¼ˆBERTæ ‡å‡†ï¼‰
- **èˆŒè±¡**ï¼š512ç»´ï¼ˆå¹³è¡¡ç²¾åº¦å’Œæ€§èƒ½ï¼‰
- **è„‰è±¡**ï¼š256ç»´ï¼ˆä¿¡å·ç‰¹å¾ç›¸å¯¹ç®€å•ï¼‰

### 2. ç¼“å­˜ç­–ç•¥
- å¯ç”¨æŸ¥è¯¢ç¼“å­˜ï¼Œé¿å…é‡å¤è®¡ç®—
- å®šæœŸæ¸…ç†è¿‡æœŸç¼“å­˜
- æ ¹æ®å†…å­˜æƒ…å†µè°ƒæ•´ç¼“å­˜å¤§å°

### 3. æ‰¹å¤„ç†ä¼˜åŒ–
- æ‰¹é‡ç¼–ç å¤šä¸ªæ–‡æ¡£
- å¹¶è¡Œå¤„ç†ä¸åŒæ¨¡æ€
- å¼‚æ­¥æ‰§è¡Œéå…³é”®æ“ä½œ

## ğŸ§ª æµ‹è¯•ç¤ºä¾‹

```typescript
// è¿è¡Œæµ‹è¯•
npm test src/core/multimodal/__tests__/

// æ€§èƒ½æµ‹è¯•
npm run test:performance

// é›†æˆæµ‹è¯•
npm run test:integration
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¼–ç å™¨åˆå§‹åŒ–å¤±è´¥**
   - æ£€æŸ¥æ¨¡å‹æ–‡ä»¶è·¯å¾„
   - ç¡®è®¤è®¾å¤‡èµ„æºå……è¶³
   - éªŒè¯ä¾èµ–åº“ç‰ˆæœ¬

2. **èåˆç»“æœç½®ä¿¡åº¦ä½**
   - è°ƒæ•´æ¨¡æ€æƒé‡
   - æ£€æŸ¥è¾“å…¥æ•°æ®è´¨é‡
   - å°è¯•ä¸åŒèåˆç­–ç•¥

3. **æ£€ç´¢ç»“æœä¸å‡†ç¡®**
   - å¢åŠ çŸ¥è¯†åº“æ–‡æ¡£
   - è°ƒæ•´ç›¸ä¼¼åº¦é˜ˆå€¼
   - ä¼˜åŒ–å‘é‡ç´¢å¼•

### è°ƒè¯•æ¨¡å¼

```typescript
// å¯ç”¨è¯¦ç»†æ—¥å¿—
ragService.on('fusionCompleted', (result) => {
  console.log('èåˆç»“æœ:', result);
});

ragService.on('retrievalCompleted', (data) => {
  console.log('æ£€ç´¢ç»“æœ:', data);
});

ragService.on('answerGenerated', (data) => {
  console.log('ç”Ÿæˆå›ç­”:', data);
});
```

## ğŸ“š APIå‚è€ƒ

è¯¦ç»†çš„APIæ–‡æ¡£è¯·å‚è€ƒå„æ¨¡å—çš„TypeScriptç±»å‹å®šä¹‰ï¼š

- [MultimodalRAGService](./MultimodalRAGService.ts)
- [MultimodalEmbeddingFusion](./MultimodalEmbeddingFusion.ts)
- [MultimodalEncoder](./MultimodalEncoder.ts)

## ğŸ¤ è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. æ¨é€åˆ°åˆ†æ”¯
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](../../../LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚ 