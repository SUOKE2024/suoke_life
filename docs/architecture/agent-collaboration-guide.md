# ç´¢å…‹ç”Ÿæ´»æ™ºèƒ½ä½“ååŒä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

ç´¢å…‹ç”Ÿæ´»å¹³å°é‡‡ç”¨äº‹ä»¶é©±åŠ¨çš„æ™ºèƒ½ä½“ååŒæ¶æ„ï¼Œå››ä¸ªæ™ºèƒ½ä½“é€šè¿‡äº‹ä»¶æ€»çº¿è¿›è¡ŒååŒå·¥ä½œï¼Œä¸ºç”¨æˆ·æä¾›å…¨æ–¹ä½çš„å¥åº·ç®¡ç†æœåŠ¡ã€‚

## ğŸ¤– æ™ºèƒ½ä½“è§’è‰²åˆ†å·¥

### å°è‰¾ï¼ˆxiaoaiï¼‰- é¦–é¡µèŠå¤©é¢‘é“ç‰ˆä¸»
- **ä¸»è¦èŒè´£**ï¼šè¯­éŸ³äº¤äº’ã€ä¸­åŒ»æœ›è¯Šã€æ™ºèƒ½é—®è¯Šã€æ— éšœç¢æœåŠ¡ã€å››è¯Šåˆå‚ç»Ÿç­¹
- **æ ¸å¿ƒèƒ½åŠ›**ï¼š
  - å¤šè¯­ç§è¯­éŸ³äº¤äº’ï¼ˆå«æ–¹è¨€è¯†åˆ«ï¼‰
  - ä¸­åŒ»é¢è‰²åˆ†æä¸èˆŒè¯Šå›¾åƒå¤„ç†
  - æ™ºèƒ½é—®è¯Šç³»ç»Ÿï¼ˆä½“è´¨ç­›æŸ¥ã€ç—‡çŠ¶è¯„ä¼°ï¼‰
  - åŒ»ç–—è®°å½•è‡ªåŠ¨æ•´ç†ä¸å¥åº·æ¡£æ¡ˆç®¡ç†
  - æ— éšœç¢æœåŠ¡ï¼ˆå¯¼ç›²ã€æ‰‹è¯­è¯†åˆ«ã€è€å¹´å‹å¥½ç•Œé¢ï¼‰

### å°å…‹ï¼ˆxiaokeï¼‰- SUOKEé¢‘é“ç‰ˆä¸»
- **ä¸»è¦èŒè´£**ï¼šæœåŠ¡è®¢é˜…ã€å†œäº§å“é¢„å®šã€ååŒ»èµ„æºåŒ¹é…ã€ç¬¬ä¸‰æ–¹APIé›†æˆ
- **æ ¸å¿ƒèƒ½åŠ›**ï¼š
  - ååŒ»èµ„æºæ™ºèƒ½åŒ¹é…ä¸é¢„çº¦ç®¡ç†
  - åŒ»ç–—æœåŠ¡è®¢é˜…ä¸ä¸ªæ€§åŒ–æ¨è
  - å†œäº§å“æº¯æºä¸å®šåˆ¶é…é€ç®¡ç†
  - ç¬¬ä¸‰æ–¹åŒ»ç–—æœåŠ¡APIé›†æˆ
  - åœ¨çº¿åº—é“ºç®¡ç†ä¸å¥åº·å•†å“æ¨è

### è€å…‹ï¼ˆlaokeï¼‰- æ¢ç´¢é¢‘é“ç‰ˆä¸»
- **ä¸»è¦èŒè´£**ï¼šçŸ¥è¯†ä¼ æ’­ã€åŸ¹è®­ç®¡ç†ã€ç¤¾åŒºå†…å®¹ç®¡ç†ã€æ¸¸æˆNPC
- **æ ¸å¿ƒèƒ½åŠ›**ï¼š
  - ä¸­åŒ»çŸ¥è¯†åº“RAGæ£€ç´¢ä¸ä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„
  - ç¤¾åŒºå†…å®¹ç®¡ç†ä¸çŸ¥è¯†è´¡çŒ®å¥–åŠ±
  - å¥åº·æ•™è‚²è¯¾ç¨‹ä¸è®¤è¯ç³»ç»Ÿ
  - ç‰ç±³è¿·å®«NPCè§’è‰²æ‰®æ¼”ä¸æ¸¸æˆå¼•å¯¼
  - ç”¨æˆ·åšå®¢ç®¡ç†ä¸å†…å®¹è´¨é‡ä¿éšœ

### ç´¢å„¿ï¼ˆsoerï¼‰- LIFEé¢‘é“ç‰ˆä¸»
- **ä¸»è¦èŒè´£**ï¼šç”Ÿæ´»å¥åº·ç®¡ç†ã€å¤šè®¾å¤‡æ•°æ®æ•´åˆã€æƒ…æ„Ÿé™ªä¼´
- **æ ¸å¿ƒèƒ½åŠ›**ï¼š
  - å¥åº·ç”Ÿæ´»ä¹ æƒ¯åŸ¹å…»ä¸è¡Œä¸ºå¹²é¢„
  - å¤šè®¾å¤‡ä¼ æ„Ÿå™¨æ•°æ®æ•´åˆä¸å¥åº·è¶‹åŠ¿åˆ†æ
  - ç¯å¢ƒä¸æƒ…ç»ªæ™ºèƒ½æ„ŸçŸ¥ä¸åŠ¨æ€å¥åº·å»ºè®®
  - ä¸ªæ€§åŒ–å…»ç”Ÿè®¡åˆ’ç”Ÿæˆä¸æ‰§è¡Œè·Ÿè¸ª
  - èº«å¿ƒå¥åº·é™ªä¼´ä¸æƒ…æ„Ÿæ”¯æŒ

## ğŸ”„ ååŒåœºæ™¯

### 1. ç»¼åˆå¥åº·è¯Šæ–­ï¼ˆcomprehensive_health_diagnosisï¼‰
**å‚ä¸æ™ºèƒ½ä½“**ï¼šå°è‰¾ã€å°å…‹ã€è€å…‹ã€ç´¢å„¿

**å·¥ä½œæµç¨‹**ï¼š
1. **å°è‰¾**ï¼šå¯åŠ¨å››è¯Šåˆå‚ç»Ÿç­¹ï¼Œè¿›è¡Œä½“è´¨ç­›æŸ¥ã€é¢è‰²åˆ†æã€èˆŒè¯Š
2. **ç´¢å„¿**ï¼šæ”¶é›†ç”Ÿæ´»æ•°æ®ï¼Œåˆ†æå¥åº·è¶‹åŠ¿å’Œç”Ÿæ´»ä¹ æƒ¯
3. **å°å…‹**ï¼šåŸºäºè¯Šæ–­ç»“æœåŒ¹é…åˆé€‚çš„åŒ»ç”Ÿèµ„æº
4. **è€å…‹**ï¼šæä¾›ç›¸å…³çš„ä¸­åŒ»çŸ¥è¯†æ”¯æŒå’Œå­¦ä¹ èµ„æº

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
# å¯åŠ¨ç»¼åˆå¥åº·è¯Šæ–­
session_id = await collaboration_manager.start_collaboration(
    scenario="comprehensive_health_diagnosis",
    user_id="user_123",
    context={
        "symptoms": ["ç–²åŠ³", "é£Ÿæ¬²ä¸æŒ¯", "ç¡çœ è´¨é‡å·®"],
        "user_info": {
            "age": 30,
            "gender": "female",
            "occupation": "office_worker"
        }
    }
)
```

### 2. ä¸ªæ€§åŒ–å…»ç”Ÿè®¡åˆ’ï¼ˆpersonalized_wellness_planï¼‰
**å‚ä¸æ™ºèƒ½ä½“**ï¼šç´¢å„¿ã€å°è‰¾ã€å°å…‹

**å·¥ä½œæµç¨‹**ï¼š
1. **ç´¢å„¿**ï¼šåŸºäºç”¨æˆ·æ•°æ®ç”Ÿæˆä¸ªæ€§åŒ–å…»ç”Ÿæ–¹æ¡ˆ
2. **å°è‰¾**ï¼šè¿›è¡Œä¸­åŒ»ä½“è´¨åˆ†æï¼Œæä¾›ä½“è´¨è°ƒç†å»ºè®®
3. **å°å…‹**ï¼šæ¨èç›¸å…³çš„å¥åº·äº§å“å’Œå†œäº§å“

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```python
# å¯åŠ¨ä¸ªæ€§åŒ–å…»ç”Ÿè®¡åˆ’
session_id = await collaboration_manager.start_collaboration(
    scenario="personalized_wellness_plan",
    user_id="user_123",
    context={
        "health_goals": ["æ”¹å–„ç¡çœ ", "å¢å¼ºä½“è´¨", "å‡è½»å‹åŠ›"],
        "lifestyle_data": {
            "sleep_hours": 6,
            "exercise_frequency": 2,
            "stress_level": "high"
        }
    }
)
```

### 3. å¥åº·æ•™è‚²å­¦ä¹ ï¼ˆhealth_education_journeyï¼‰
**å‚ä¸æ™ºèƒ½ä½“**ï¼šè€å…‹ã€å°è‰¾ã€ç´¢å„¿

**å·¥ä½œæµç¨‹**ï¼š
1. **è€å…‹**ï¼šæ¨èä¸ªæ€§åŒ–çš„çŸ¥è¯†å†…å®¹å’Œå­¦ä¹ è·¯å¾„
2. **å°è‰¾**ï¼šæä¾›äº’åŠ¨å¼å­¦ä¹ ä½“éªŒ
3. **ç´¢å„¿**ï¼šè·Ÿè¸ªå®è·µæŒ‡å¯¼å’Œå­¦ä¹ æ•ˆæœ

### 4. ç´§æ€¥å¥åº·æ”¯æŒï¼ˆemergency_health_supportï¼‰
**å‚ä¸æ™ºèƒ½ä½“**ï¼šç´¢å„¿ã€å°è‰¾ã€å°å…‹

**å·¥ä½œæµç¨‹**ï¼š
1. **ç´¢å„¿**ï¼šæ£€æµ‹å¼‚å¸¸å¥åº·çŠ¶æ€
2. **å°è‰¾**ï¼šè¿›è¡Œç´§æ€¥å¥åº·è¯„ä¼°
3. **å°å…‹**ï¼šå¿«é€Ÿè°ƒåº¦åŒ»ç–—èµ„æº

## ğŸ›  APIä½¿ç”¨æŒ‡å—

### å¯åŠ¨ååŒ
```http
POST /api/v1/collaboration/start
Content-Type: application/json

{
    "scenario": "comprehensive_health_diagnosis",
    "user_id": "user_123",
    "context": {
        "symptoms": ["ç–²åŠ³", "å¤´ç—›"],
        "urgency": "normal"
    }
}
```

### æŸ¥è¯¢ååŒçŠ¶æ€
```http
GET /api/v1/collaboration/sessions/{session_id}
```

### å–æ¶ˆååŒ
```http
DELETE /api/v1/collaboration/sessions/{session_id}
```

### è·å–æ´»è·ƒä¼šè¯
```http
GET /api/v1/collaboration/sessions
```

## ğŸ“Š äº‹ä»¶ç±»å‹

### å°è‰¾äº‹ä»¶
- `xiaoai.voice.interaction_started` - è¯­éŸ³äº¤äº’å¼€å§‹
- `xiaoai.look.face_color_completed` - é¢è‰²åˆ†æå®Œæˆ
- `xiaoai.look.tongue_diagnosis_completed` - èˆŒè¯Šå®Œæˆ
- `xiaoai.inquiry.constitution_screening_completed` - ä½“è´¨ç­›æŸ¥å®Œæˆ
- `xiaoai.coordination.four_diagnosis_completed` - å››è¯Šåˆå‚å®Œæˆ

### å°å…‹äº‹ä»¶
- `xiaoke.doctor.matching_completed` - åŒ»ç”ŸåŒ¹é…å®Œæˆ
- `xiaoke.subscription.service_completed` - æœåŠ¡è®¢é˜…å®Œæˆ
- `xiaoke.agriculture.product_customized` - å†œäº§å“å®šåˆ¶å®Œæˆ

### è€å…‹äº‹ä»¶
- `laoke.knowledge.search_completed` - çŸ¥è¯†æœç´¢å®Œæˆ
- `laoke.training.course_started` - åŸ¹è®­è¯¾ç¨‹å¼€å§‹
- `laoke.game.maze_started` - è¿·å®«æ¸¸æˆå¼€å§‹

### ç´¢å„¿äº‹ä»¶
- `soer.sensor.data_collected` - ä¼ æ„Ÿå™¨æ•°æ®æ”¶é›†
- `soer.wellness.plan_created` - å…»ç”Ÿè®¡åˆ’åˆ›å»º
- `soer.emotion.support_provided` - æƒ…æ„Ÿæ”¯æŒæä¾›

### ååŒäº‹ä»¶
- `collaboration.multi_agent_consultation_started` - å¤šæ™ºèƒ½ä½“ååŒå¼€å§‹
- `collaboration.agent_handoff_initiated` - æ™ºèƒ½ä½“äº¤æ¥å‘èµ·
- `collaboration.seamless_experience_orchestrated` - æ— ç¼ä½“éªŒç¼–æ’

## ğŸ”§ å¼€å‘æŒ‡å—

### åˆ›å»ºæ–°çš„æ™ºèƒ½ä½“
```python
from communication_service.event_bus.core.event_bus import SuokeEventBus
from communication_service.event_bus.orchestration import AgentCollaborationManager

class CustomAgent:
    def __init__(self, event_bus: SuokeEventBus):
        self.event_bus = event_bus
        
    async def initialize(self):
        # è®¢é˜…ç›¸å…³äº‹ä»¶
        await self.event_bus.subscribe(
            "custom.event.type",
            self._handle_custom_event
        )
    
    async def _handle_custom_event(self, event_data):
        # å¤„ç†äº‹ä»¶é€»è¾‘
        pass
```

### æ·»åŠ æ–°çš„ååŒåœºæ™¯
```python
# åœ¨ agent_event_types.py ä¸­æ·»åŠ æ–°åœºæ™¯
COLLABORATION_SCENARIOS["new_scenario"] = {
    "description": "æ–°ååŒåœºæ™¯",
    "participating_agents": ["xiaoai", "xiaoke"],
    "workflow": [
        "xiaoai.æŸé¡¹ä»»åŠ¡",
        "xiaoke.æŸé¡¹ä»»åŠ¡"
    ]
}
```

### è‡ªå®šä¹‰äº‹ä»¶å¤„ç†å™¨
```python
class CustomEventHandler:
    async def handle_event(self, event_type: str, event_data: Dict[str, Any]):
        if event_type == "custom.event":
            # è‡ªå®šä¹‰å¤„ç†é€»è¾‘
            await self._process_custom_logic(event_data)
    
    async def _process_custom_logic(self, data):
        # å®ç°å…·ä½“çš„ä¸šåŠ¡é€»è¾‘
        pass
```

## ğŸ“ˆ ç›‘æ§ä¸è¿ç»´

### ååŒæŒ‡æ ‡ç›‘æ§
```http
GET /api/v1/collaboration/metrics
```

è¿”å›ç¤ºä¾‹ï¼š
```json
{
    "total_active_sessions": 5,
    "state_distribution": {
        "executing": 3,
        "completed": 2
    },
    "scenario_distribution": {
        "comprehensive_health_diagnosis": 3,
        "personalized_wellness_plan": 2
    }
}
```

### æ™ºèƒ½ä½“çŠ¶æ€ç›‘æ§
```http
GET /api/v1/collaboration/agents/status
```

### æ—¥å¿—ç›‘æ§
- ååŒä¼šè¯æ—¥å¿—ï¼š`/logs/collaboration/`
- æ™ºèƒ½ä½“æ—¥å¿—ï¼š`/logs/agents/`
- äº‹ä»¶æ€»çº¿æ—¥å¿—ï¼š`/logs/event_bus/`

## ğŸš¨ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ååŒä¼šè¯è¶…æ—¶**
   - æ£€æŸ¥æ™ºèƒ½ä½“æœåŠ¡çŠ¶æ€
   - æŸ¥çœ‹äº‹ä»¶æ€»çº¿è¿æ¥
   - è°ƒæ•´è¶…æ—¶é…ç½®

2. **æ™ºèƒ½ä½“æ— å“åº”**
   - æ£€æŸ¥æ™ºèƒ½ä½“æœåŠ¡å¥åº·çŠ¶æ€
   - éªŒè¯äº‹ä»¶è®¢é˜…é…ç½®
   - æŸ¥çœ‹é”™è¯¯æ—¥å¿—

3. **äº‹ä»¶ä¸¢å¤±**
   - æ£€æŸ¥Redisè¿æ¥çŠ¶æ€
   - éªŒè¯äº‹ä»¶å‘å¸ƒé…ç½®
   - æŸ¥çœ‹äº‹ä»¶å­˜å‚¨æ—¥å¿—

### è°ƒè¯•å·¥å…·

```python
# å¯ç”¨è°ƒè¯•æ¨¡å¼
import logging
logging.getLogger("collaboration").setLevel(logging.DEBUG)

# æµ‹è¯•ååŒ
await collaboration_manager.start_collaboration(
    scenario="comprehensive_health_diagnosis",
    user_id="debug_user",
    context={"debug_mode": True}
)
```

## ğŸ”’ å®‰å…¨è€ƒè™‘

### æ•°æ®éšç§
- å¥åº·æ•°æ®åŠ å¯†ä¼ è¾“
- äº‹ä»¶æ•°æ®è„±æ•å¤„ç†
- ç”¨æˆ·æˆæƒéªŒè¯

### è®¿é—®æ§åˆ¶
- APIæ¥å£é‰´æƒ
- æ™ºèƒ½ä½“æƒé™ç®¡ç†
- ååŒä¼šè¯éš”ç¦»

### å®¡è®¡æ—¥å¿—
- ååŒæ“ä½œè®°å½•
- æ•°æ®è®¿é—®æ—¥å¿—
- å¼‚å¸¸äº‹ä»¶è¿½è¸ª

## ğŸ“š æœ€ä½³å®è·µ

### ååŒè®¾è®¡åŸåˆ™
1. **æ¾è€¦åˆ**ï¼šæ™ºèƒ½ä½“é—´é€šè¿‡äº‹ä»¶é€šä¿¡ï¼Œé¿å…ç›´æ¥ä¾èµ–
2. **å¼‚æ­¥å¤„ç†**ï¼šä½¿ç”¨å¼‚æ­¥äº‹ä»¶å¤„ç†ï¼Œæé«˜ç³»ç»Ÿå“åº”æ€§
3. **å®¹é”™æœºåˆ¶**ï¼šå®ç°é‡è¯•ã€é™çº§å’Œæ•…éšœæ¢å¤
4. **å¯è§‚æµ‹æ€§**ï¼šå®Œå–„çš„æ—¥å¿—ã€ç›‘æ§å’Œè¿½è¸ª

### æ€§èƒ½ä¼˜åŒ–
1. **äº‹ä»¶æ‰¹å¤„ç†**ï¼šåˆå¹¶ç›¸å…³äº‹ä»¶å‡å°‘ç½‘ç»œå¼€é”€
2. **ç¼“å­˜ç­–ç•¥**ï¼šç¼“å­˜é¢‘ç¹è®¿é—®çš„æ•°æ®
3. **è´Ÿè½½å‡è¡¡**ï¼šåˆ†å¸ƒå¼éƒ¨ç½²æ™ºèƒ½ä½“æœåŠ¡
4. **èµ„æºç®¡ç†**ï¼šåˆç†é…ç½®è¶…æ—¶å’Œé‡è¯•å‚æ•°

### æ‰©å±•æ€§è®¾è®¡
1. **æ’ä»¶åŒ–æ¶æ„**ï¼šæ”¯æŒåŠ¨æ€åŠ è½½æ–°çš„æ™ºèƒ½ä½“
2. **é…ç½®é©±åŠ¨**ï¼šé€šè¿‡é…ç½®æ–‡ä»¶ç®¡ç†ååŒæµç¨‹
3. **ç‰ˆæœ¬å…¼å®¹**ï¼šä¿æŒäº‹ä»¶æ ¼å¼çš„å‘åå…¼å®¹æ€§
4. **æ°´å¹³æ‰©å±•**ï¼šæ”¯æŒæ™ºèƒ½ä½“æœåŠ¡çš„æ°´å¹³æ‰©å±•

## ğŸ¯ æœªæ¥è§„åˆ’

### çŸ­æœŸç›®æ ‡
- [ ] å®Œå–„æ™ºèƒ½ä½“ååŒæµ‹è¯•ç”¨ä¾‹
- [ ] ä¼˜åŒ–äº‹ä»¶å¤„ç†æ€§èƒ½
- [ ] å¢åŠ æ›´å¤šååŒåœºæ™¯

### ä¸­æœŸç›®æ ‡
- [ ] å®ç°æ™ºèƒ½ä½“å­¦ä¹ èƒ½åŠ›
- [ ] æ”¯æŒåŠ¨æ€ååŒæµç¨‹é…ç½®
- [ ] é›†æˆæ›´å¤šç¬¬ä¸‰æ–¹æœåŠ¡

### é•¿æœŸç›®æ ‡
- [ ] æ„å»ºæ™ºèƒ½ä½“ç”Ÿæ€ç³»ç»Ÿ
- [ ] å®ç°è‡ªé€‚åº”ååŒä¼˜åŒ–
- [ ] æ”¯æŒè·¨å¹³å°æ™ºèƒ½ä½“ååŒ 