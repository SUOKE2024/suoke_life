# ç´¢å…‹ç”Ÿæ´»å¹³å°æ–°åŠŸèƒ½å®Œæˆæ€»ç»“

## æ¦‚è¿°

æœ¬æ¬¡å¼€å‘æˆåŠŸä¸ºç´¢å…‹ç”Ÿæ´»ï¼ˆSuoke Lifeï¼‰å¥åº·ç®¡ç†å¹³å°å®žçŽ°äº†å››ä¸ªæ ¸å¿ƒåŸºç¡€è®¾æ–½æ¨¡å—ï¼Œä¸ºå¹³å°çš„å››ä¸ªæ™ºèƒ½ä½“ï¼ˆå°è‰¾ã€å°å…‹ã€è€å…‹ã€ç´¢å„¿ï¼‰æä¾›äº†å®Œæ•´çš„å¾®æœåŠ¡æ”¯æŒã€‚

## å·²å®ŒæˆåŠŸèƒ½æ¨¡å—

### ðŸ”— 1. å›¾æ•°æ®åº“æ”¯æŒæ¨¡å— (database/graph/)

**å®žçŽ°æ–‡ä»¶ï¼š**
- `services/common/database/graph/graph_db.py` - å›¾æ•°æ®åº“æŠ½è±¡åŸºç±»
- `services/common/database/graph/neo4j_client.py` - Neo4jå®¢æˆ·ç«¯å®žçŽ°
- `services/common/database/graph/arangodb_client.py` - ArangoDBå®¢æˆ·ç«¯å®žçŽ°
- `services/common/database/graph/__init__.py` - æ¨¡å—åˆå§‹åŒ–

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âœ… ç»Ÿä¸€çš„å›¾æ•°æ®åº“æŠ½è±¡æŽ¥å£
- âœ… Neo4jå¼‚æ­¥å®¢æˆ·ç«¯ï¼ˆæ”¯æŒCypheræŸ¥è¯¢ã€äº‹åŠ¡å¤„ç†ï¼‰
- âœ… ArangoDBå¼‚æ­¥å®¢æˆ·ç«¯ï¼ˆæ”¯æŒAQLæŸ¥è¯¢ã€å›¾éåŽ†ï¼‰
- âœ… å¥åº·çŸ¥è¯†å›¾è°±ä¸“ç”¨æ•°æ®æ¨¡åž‹
- âœ… èŠ‚ç‚¹å’Œå…³ç³»çš„CRUDæ“ä½œ
- âœ… è¿žæŽ¥æ± ç®¡ç†å’Œå¥åº·æ£€æŸ¥
- âœ… å…¨å±€å›¾æ•°æ®åº“æ³¨å†Œè¡¨

**å¥åº·ç®¡ç†åº”ç”¨ï¼š**
- ç”¨æˆ·å¥åº·æ¡£æ¡ˆå›¾è°±æž„å»º
- ç—‡çŠ¶-è¯åž‹å…³ç³»å»ºæ¨¡
- ä¸­åŒ»è¾¨è¯è®ºæ²»çŸ¥è¯†å›¾è°±
- æ™ºèƒ½ä½“å†³ç­–è·¯å¾„è¿½è¸ª

### ðŸ“š 2. APIæ–‡æ¡£ç”Ÿæˆæ¨¡å— (api-docs/)

**å®žçŽ°æ–‡ä»¶ï¼š**
- `services/common/api_docs/openapi_generator.py` - OpenAPIæ–‡æ¡£ç”Ÿæˆå™¨
- `services/common/api_docs/doc_decorators.py` - APIæ–‡æ¡£è£…é¥°å™¨
- `services/common/api_docs/swagger_ui.py` - Swagger UIæœåŠ¡å™¨
- `services/common/api_docs/__init__.py` - æ¨¡å—åˆå§‹åŒ–

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âœ… OpenAPI 3.0è§„èŒƒè‡ªåŠ¨ç”Ÿæˆ
- âœ… è£…é¥°å™¨é©±åŠ¨çš„APIæ–‡æ¡£
- âœ… Swagger UIå¯è§†åŒ–ç•Œé¢
- âœ… JSON/YAMLæ ¼å¼è¾“å‡º
- âœ… å¥åº·ç®¡ç†å¹³å°ä¸“ç”¨æ•°æ®æ¨¡åž‹
- âœ… å¤šç§è£…é¥°å™¨æ”¯æŒï¼ˆ@api_docã€@get_apiã€@post_apiç­‰ï¼‰
- âœ… å®‰å…¨è®¤è¯è£…é¥°å™¨ï¼ˆ@bearer_authã€@api_key_authï¼‰

**å¥åº·ç®¡ç†åº”ç”¨ï¼š**
- æ™ºèƒ½ä½“APIæŽ¥å£æ–‡æ¡£
- å¥åº·è¯„ä¼°APIè§„èŒƒ
- ä¸­åŒ»è¾¨è¯APIæ–‡æ¡£
- ç”¨æˆ·å¥åº·æ•°æ®API

### ðŸ•¸ï¸ 3. æœåŠ¡ç½‘æ ¼æ”¯æŒæ¨¡å— (service-mesh/)

**å®žçŽ°æ–‡ä»¶ï¼š**
- `services/common/service_mesh/mesh_manager.py` - æœåŠ¡ç½‘æ ¼ç®¡ç†å™¨
- `services/common/service_mesh/istio_client.py` - Istioå®¢æˆ·ç«¯
- `services/common/service_mesh/linkerd_client.py` - Linkerdå®¢æˆ·ç«¯
- `services/common/service_mesh/envoy_config.py` - Envoyé…ç½®ç®¡ç†
- `services/common/service_mesh/__init__.py` - æ¨¡å—åˆå§‹åŒ–

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âœ… ç»Ÿä¸€çš„æœåŠ¡ç½‘æ ¼ç®¡ç†æŽ¥å£
- âœ… Istioæ”¯æŒï¼ˆVirtualServiceã€DestinationRuleã€Gatewayï¼‰
- âœ… Linkerdæ”¯æŒï¼ˆTrafficSplitã€ServiceProfileï¼‰
- âœ… Envoyé…ç½®ç®¡ç†ï¼ˆé›†ç¾¤ã€ç›‘å¬å™¨ã€è·¯ç”±ï¼‰
- âœ… æµé‡ç­–ç•¥é…ç½®ï¼ˆé‡‘ä¸é›€å‘å¸ƒã€è“ç»¿éƒ¨ç½²ï¼‰
- âœ… å®‰å…¨ç­–ç•¥é…ç½®ï¼ˆmTLSã€è®¿é—®æŽ§åˆ¶ï¼‰
- âœ… å¯è§‚æµ‹æ€§é…ç½®ï¼ˆè¿½è¸ªã€æŒ‡æ ‡ã€æ—¥å¿—ï¼‰

**å¥åº·ç®¡ç†åº”ç”¨ï¼š**
- æ™ºèƒ½ä½“æœåŠ¡é—´é€šä¿¡ç®¡ç†
- å¥åº·æœåŠ¡æµé‡æŽ§åˆ¶
- å¾®æœåŠ¡å®‰å…¨ç­–ç•¥
- æœåŠ¡æ€§èƒ½ç›‘æŽ§

### ðŸ§ª 4. æµ‹è¯•æ¡†æž¶æ¨¡å— (testing/)

**å®žçŽ°æ–‡ä»¶ï¼š**
- `services/common/testing/test_framework.py` - ç»Ÿä¸€æµ‹è¯•æ¡†æž¶
- `services/common/testing/__init__.py` - æ¨¡å—åˆå§‹åŒ–

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
- âœ… å¤šç§æµ‹è¯•ç±»åž‹æ”¯æŒï¼ˆå•å…ƒã€é›†æˆã€æ€§èƒ½ã€ç«¯åˆ°ç«¯ï¼‰
- âœ… å¼‚æ­¥æµ‹è¯•å‡½æ•°æ”¯æŒ
- âœ… å¹¶è¡Œ/ä¸²è¡Œæµ‹è¯•æ‰§è¡Œ
- âœ… å®Œæ•´çš„setup/teardownæœºåˆ¶
- âœ… æµ‹è¯•ç»“æžœç»Ÿè®¡å’ŒæŠ¥å‘Š
- âœ… æµ‹è¯•ç”¨ä¾‹è¿‡æ»¤å’Œåˆ†ç»„
- âœ… å…¨å±€æµ‹è¯•æ¡†æž¶æ³¨å†Œè¡¨

**å¥åº·ç®¡ç†åº”ç”¨ï¼š**
- æ™ºèƒ½ä½“åŠŸèƒ½æµ‹è¯•
- å¥åº·è¯„ä¼°ç®—æ³•æµ‹è¯•
- APIæŽ¥å£æµ‹è¯•
- ç³»ç»Ÿé›†æˆæµ‹è¯•

## æŠ€æœ¯ç‰¹ç‚¹

### ðŸš€ çŽ°ä»£åŒ–æž¶æž„
- **å¼‚æ­¥ç¼–ç¨‹**: æ‰€æœ‰æ¨¡å—éƒ½ä½¿ç”¨asyncioè¿›è¡Œå¼‚æ­¥å¤„ç†
- **ç±»åž‹å®‰å…¨**: å¹¿æ³›ä½¿ç”¨ç±»åž‹æç¤ºå’Œæ•°æ®ç±»
- **è£…é¥°å™¨æ¨¡å¼**: æä¾›ä¾¿æ·çš„è£…é¥°å™¨æŽ¥å£
- **å•ä¸€èŒè´£**: æ¯ä¸ªæ¨¡å—èŒè´£æ˜Žç¡®ï¼ŒæŽ¥å£æ¸…æ™°

### ðŸ”§ é«˜æ€§èƒ½è®¾è®¡
- **è¿žæŽ¥æ± ç®¡ç†**: æ•°æ®åº“è¿žæŽ¥æ± ä¼˜åŒ–
- **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡æ•°æ®å¤„ç†
- **ç¼“å­˜ç­–ç•¥**: å¤šçº§ç¼“å­˜æ”¯æŒ
- **å¼‚æ­¥I/O**: é«˜å¹¶å‘å¼‚æ­¥æ“ä½œ

### ðŸ›¡ï¸ å®‰å…¨è€ƒè™‘
- **æ•°æ®åŠ å¯†**: æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
- **è®¿é—®æŽ§åˆ¶**: åŸºäºŽè§’è‰²çš„æƒé™ç®¡ç†
- **å®‰å…¨ä¼ è¾“**: mTLSå’ŒHTTPSæ”¯æŒ
- **å®¡è®¡æ—¥å¿—**: å®Œæ•´çš„æ“ä½œå®¡è®¡

### ðŸ“Š å¯è§‚æµ‹æ€§
- **åˆ†å¸ƒå¼è¿½è¸ª**: OpenTelemetryé›†æˆ
- **æŒ‡æ ‡æ”¶é›†**: PrometheusæŒ‡æ ‡
- **ç»“æž„åŒ–æ—¥å¿—**: ç»Ÿä¸€æ—¥å¿—æ ¼å¼
- **å¥åº·æ£€æŸ¥**: æœåŠ¡å¥åº·ç›‘æŽ§

## ç´¢å…‹ç”Ÿæ´»å¹³å°ä¸“ç”¨åŠŸèƒ½

### ðŸ¥ ä¸­åŒ»è¾¨è¯è®ºæ²»æ•°å­—åŒ–
- **è¯åž‹è¯†åˆ«**: åŸºäºŽç—‡çŠ¶çš„è‡ªåŠ¨è¯åž‹è¯†åˆ«
- **çŸ¥è¯†å›¾è°±**: ä¸­åŒ»ç†è®ºçŸ¥è¯†å›¾è°±æž„å»º
- **æ–¹å‰‚æŽ¨è**: ä¸ªæ€§åŒ–ä¸­è¯æ–¹å‰‚æŽ¨è
- **ç–—æ•ˆè¿½è¸ª**: æ²»ç–—æ•ˆæžœæŒç»­ç›‘æµ‹

### ðŸ¤– å››ä¸ªæ™ºèƒ½ä½“æž¶æž„æ”¯æŒ
- **å°è‰¾ (Xiaoai)**: å¥åº·å’¨è¯¢å’Œåˆæ­¥è¯Šæ–­æœåŠ¡
- **å°å…‹ (Xiaoke)**: ä¸ªæ€§åŒ–å¥åº·æ–¹æ¡ˆåˆ¶å®šæœåŠ¡
- **è€å…‹ (Laoke)**: ä¸­åŒ»å…»ç”ŸæŒ‡å¯¼æœåŠ¡
- **ç´¢å„¿ (Soer)**: å¥åº·æ•°æ®åˆ†æžå’Œé¢„æµ‹æœåŠ¡

### ðŸ“± å¥åº·æ•°æ®ç®¡ç†
- **å¤šæ¨¡æ€æ•°æ®**: æ–‡æœ¬ã€å›¾åƒã€éŸ³é¢‘æ•°æ®æ”¯æŒ
- **éšç§ä¿æŠ¤**: é›¶çŸ¥è¯†è¯æ˜Žå¥åº·æ•°æ®éªŒè¯
- **åŒºå—é“¾å­˜å‚¨**: ä¸å¯ç¯¡æ”¹çš„å¥åº·è®°å½•
- **æ™ºèƒ½åˆ†æž**: AIé©±åŠ¨çš„å¥åº·è¶‹åŠ¿åˆ†æž

## é…ç½®å’Œéƒ¨ç½²

### ðŸ“¦ ä¾èµ–ç®¡ç†
æ›´æ–°äº† `services/common/requirements.txt`ï¼Œæ·»åŠ äº†ä»¥ä¸‹æ–°ä¾èµ–ï¼š
```
# å›¾æ•°æ®åº“
neo4j>=5.15.0,<6.0.0
aioarangodb>=0.1.0,<1.0.0

# æœåŠ¡ç½‘æ ¼å’ŒKubernetes
kubernetes>=28.1.0,<29.0.0
```

### âš™ï¸ çŽ¯å¢ƒé…ç½®
```bash
# å›¾æ•°æ®åº“é…ç½®
NEO4J_URI=bolt://localhost:7687
NEO4J_USERNAME=neo4j
NEO4J_PASSWORD=password

# æœåŠ¡ç½‘æ ¼é…ç½®
ISTIO_NAMESPACE=istio-system
LINKERD_NAMESPACE=linkerd

# APIæ–‡æ¡£é…ç½®
SWAGGER_UI_PORT=8081
API_DOCS_TITLE=ç´¢å…‹ç”Ÿæ´»APIæ–‡æ¡£
```

### ðŸ³ å®¹å™¨åŒ–æ”¯æŒ
æ‰€æœ‰æ¨¡å—éƒ½æ”¯æŒå®¹å™¨åŒ–éƒ¨ç½²ï¼Œå¯ä»¥è½»æ¾é›†æˆåˆ°KubernetesçŽ¯å¢ƒä¸­ã€‚

## ä½¿ç”¨ç¤ºä¾‹

### ðŸ“– å®Œæ•´ç¤ºä¾‹
åˆ›å»ºäº† `services/common/examples/service_mesh_example.py`ï¼Œå±•ç¤ºäº†ï¼š
- æœåŠ¡ç½‘æ ¼é…ç½®å’Œç®¡ç†
- å›¾æ•°æ®åº“æ“ä½œ
- APIæ–‡æ¡£ç”Ÿæˆ
- æµ‹è¯•æ¡†æž¶ä½¿ç”¨
- å¥åº·ç®¡ç†ä¸“ç”¨åŠŸèƒ½

### ðŸ§ª æµ‹è¯•éªŒè¯
åˆ›å»ºäº†æµ‹è¯•è„šæœ¬éªŒè¯æ‰€æœ‰åŠŸèƒ½ï¼š
- `test_new_features.py` - å®Œæ•´åŠŸèƒ½æµ‹è¯•
- `simple_test.py` - åŸºç¡€åŠŸèƒ½éªŒè¯

**æµ‹è¯•ç»“æžœï¼š** âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

## æ–‡æ¡£å’Œæ”¯æŒ

### ðŸ“š æ–‡æ¡£
- `services/common/README.md` - è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£
- æ¯ä¸ªæ¨¡å—éƒ½æœ‰å®Œæ•´çš„ä¸­æ–‡æ³¨é‡Š
- æä¾›äº†ä¸°å¯Œçš„ä½¿ç”¨ç¤ºä¾‹

### ðŸ”— é›†æˆæŒ‡å—
- ä¸ŽçŽ°æœ‰æœåŠ¡çš„é›†æˆæ–¹æ³•
- é…ç½®æœ€ä½³å®žè·µ
- æ€§èƒ½ä¼˜åŒ–å»ºè®®
- æ•…éšœæŽ’é™¤æŒ‡å—

## ä¸‹ä¸€æ­¥è®¡åˆ’

### ðŸš€ åŠŸèƒ½æ‰©å±•
1. **æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å—**: Kafka/RabbitMQæ”¯æŒ
2. **é…ç½®ç®¡ç†æ¨¡å—**: åŠ¨æ€é…ç½®å’Œçƒ­æ›´æ–°
3. **åˆ†å¸ƒå¼äº‹åŠ¡æ¨¡å—**: Saga/TCCæ¨¡å¼æ”¯æŒ
4. **æ€§èƒ½ä¼˜åŒ–æ¨¡å—**: ç¼“å­˜å’Œè¿žæŽ¥æ± ç®¡ç†

### ðŸ”§ ä¼˜åŒ–æ”¹è¿›
1. **æ€§èƒ½æµ‹è¯•**: åŽ‹åŠ›æµ‹è¯•å’Œæ€§èƒ½åŸºå‡†
2. **å®‰å…¨åŠ å›º**: å®‰å…¨æ‰«æå’Œæ¼æ´žä¿®å¤
3. **ç›‘æŽ§å®Œå–„**: æ›´è¯¦ç»†çš„ç›‘æŽ§æŒ‡æ ‡
4. **æ–‡æ¡£å®Œå–„**: APIæ–‡æ¡£å’Œç”¨æˆ·æ‰‹å†Œ

## æ€»ç»“

æœ¬æ¬¡å¼€å‘æˆåŠŸä¸ºç´¢å…‹ç”Ÿæ´»å¹³å°å®žçŽ°äº†å››ä¸ªæ ¸å¿ƒåŸºç¡€è®¾æ–½æ¨¡å—ï¼Œä¸ºå¹³å°çš„å¾®æœåŠ¡æž¶æž„å¥ å®šäº†åšå®žçš„åŸºç¡€ã€‚è¿™äº›æ¨¡å—ä¸ä»…æä¾›äº†çŽ°ä»£åŒ–çš„æŠ€æœ¯æ”¯æŒï¼Œè¿˜ä¸“é—¨é’ˆå¯¹å¥åº·ç®¡ç†å’Œä¸­åŒ»è¾¨è¯è®ºæ²»çš„éœ€æ±‚è¿›è¡Œäº†ä¼˜åŒ–ã€‚

**ä¸»è¦æˆå°±ï¼š**
- âœ… å®Œæˆäº†å›¾æ•°æ®åº“ã€APIæ–‡æ¡£ç”Ÿæˆã€æœåŠ¡ç½‘æ ¼ã€æµ‹è¯•æ¡†æž¶å››ä¸ªæ ¸å¿ƒæ¨¡å—
- âœ… å®žçŽ°äº†ä¸­åŒ»è¾¨è¯è®ºæ²»çš„æ•°å­—åŒ–æ”¯æŒ
- âœ… ä¸ºå››ä¸ªæ™ºèƒ½ä½“æä¾›äº†å®Œæ•´çš„åŸºç¡€è®¾æ–½
- âœ… å»ºç«‹äº†çŽ°ä»£åŒ–çš„å¾®æœåŠ¡æž¶æž„åŸºç¡€
- âœ… æä¾›äº†å®Œæ•´çš„æ–‡æ¡£å’Œç¤ºä¾‹

**æŠ€æœ¯ä»·å€¼ï¼š**
- ðŸš€ çŽ°ä»£åŒ–çš„å¼‚æ­¥æž¶æž„è®¾è®¡
- ðŸ”’ å®Œå–„çš„å®‰å…¨å’Œéšç§ä¿æŠ¤
- ðŸ“Š å…¨é¢çš„å¯è§‚æµ‹æ€§æ”¯æŒ
- ðŸ¥ ä¸“ä¸šçš„å¥åº·ç®¡ç†åŠŸèƒ½
- ðŸ¤– æ™ºèƒ½ä½“åä½œæž¶æž„

ç´¢å…‹ç”Ÿæ´»å¹³å°çŽ°åœ¨å…·å¤‡äº†æ”¯æ’‘å¤§è§„æ¨¡å¥åº·ç®¡ç†æœåŠ¡çš„æŠ€æœ¯åŸºç¡€ï¼Œå¯ä»¥ä¸ºç”¨æˆ·æä¾›ä¸ªæ€§åŒ–ã€æ™ºèƒ½åŒ–çš„å¥åº·ç®¡ç†ä½“éªŒã€‚ 