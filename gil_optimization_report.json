{
  "analysis_timestamp": "2025-06-02 09:27:03",
  "summary": {
    "total_issues": 108,
    "high_severity": 54,
    "medium_severity": 54,
    "low_severity": 0,
    "affected_files": 87
  },
  "issue_types": {
    "threading_lock": 54,
    "thread_pool_executor": 54
  },
  "top_affected_files": [
    [
      "services/message-bus/pkg/utils/security_manager.py",
      5
    ],
    [
      "services/agent-services/xiaoai-service/xiaoai/resilience/service_governance.py",
      4
    ],
    [
      "services/agent-services/xiaoai-service/xiaoai/integration/enhanced_accessibility_client.py",
      3
    ],
    [
      "services/agent-services/xiaoai-service/xiaoai/observability/enhanced_monitoring.py",
      3
    ],
    [
      "services/accessibility-service/~/.cache/uv/archive-v0/VHwLCRAEZYIbRpc_iWSOH/numpy/_core/tests/test_multithreading.py",
      3
    ],
    [
      "services/message-bus/pkg/utils/enhanced_metrics.py",
      3
    ],
    [
      "services/agent-services/xiaoai-service/xiaoai/platform/memory_optimizer.py",
      2
    ],
    [
      "services/accessibility-service/~/.cache/uv/archive-v0/LcvuQ5avgk6zkZurlcatX/sqlalchemy/util/langhelpers.py",
      2
    ],
    [
      "services/accessibility-service/~/.cache/uv/archive-v0/txxVyGNWnRt6Rle31Lbh0/httpcore/_synchronization.py",
      2
    ],
    [
      "services/accessibility-service/~/.cache/uv/archive-v0/qVO0-cC3mtPVZVmf44G4v/websockets/sync/connection.py",
      2
    ]
  ],
  "high_priority_issues": [
    {
      "file": "services/corn-maze-service/tests/integration/test_service.py",
      "line": 30,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "cls.server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/corn-maze-service/tests/integration/test_maze_api.py",
      "line": 67,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "cls.server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/corn-maze-service/corn_maze_service/cmd/server/main.py",
      "line": 57,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "ThreadPoolExecutor(max_workers=settings.grpc.max_workers),",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/corn-maze-service/cmd/server/main.py",
      "line": 159,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "futures.ThreadPoolExecutor(max_workers=max_workers),",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/suoke-bench-service/internal/benchmark/task_manager.py",
      "line": 56,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "self.executor = ThreadPoolExecutor(max_workers=max_workers)",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/suoke-bench-service/internal/benchmark/benchmark_service.py",
      "line": 82,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "self.executor = ThreadPoolExecutor(",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/suoke-bench-service/cmd/server/main.py",
      "line": 226,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "server = grpc.server(futures.ThreadPoolExecutor(max_workers=workers))",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/agent-services/soer-service/cmd/server.py",
      "line": 73,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "futures.ThreadPoolExecutor(max_workers=config.get('grpc', {}).get('max_workers', 10))",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/agent-services/soer-service/cmd/enhanced_server.py",
      "line": 202,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "futures.ThreadPoolExecutor(max_workers=grpc_config.max_workers)",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/agent-services/xiaoke-service/cmd/server/__main__.py",
      "line": 56,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "futures.ThreadPoolExecutor(max_workers=max_workers),",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/agent-services/xiaoai-service/tests/integration/test_server_startup.py",
      "line": 33,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "futures.ThreadPoolExecutor(max_workers=server.max_workers)",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/agent-services/xiaoai-service/xiaoai/integration/device_manager.py",
      "line": 434,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "self.threadpool = ThreadPoolExecutor(max_workers=4, thread_name_prefix=\"device_worker\")",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/agent-services/xiaoai-service/xiaoai/integration/enhanced_accessibility_client.py",
      "line": 98,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "self.executor = ThreadPoolExecutor(max_workers=3)",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/agent-services/xiaoai-service/xiaoai/four_diagnosis/device_coordinator.py",
      "line": 508,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "server = grpc.server(futures.ThreadPoolExecutor(max_workers=10))",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/agent-services/xiaoai-service/xiaoai/four_diagnosis/optimized_multimodal_fusion.py",
      "line": 176,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "self.executor = ThreadPoolExecutor(max_workers=4)",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/agent-services/xiaoai-service/xiaoai/service/cache_manager.py",
      "line": 133,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "self.executor = ThreadPoolExecutor(max_workers=4)",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/med-knowledge/app/main.py",
      "line": 166,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "grpc_server = grpc.aio.server(futures.ThreadPoolExecutor(max_workers=10))",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/accessibility-service/~/.cache/uv/archive-v0/eWjAHVtOQt7b6hdVCZyaL/setuptools/_distutils/command/build_ext.py",
      "line": 499,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "with ThreadPoolExecutor(max_workers=workers) as executor:",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/accessibility-service/~/.cache/uv/archive-v0/eWjAHVtOQt7b6hdVCZyaL/setuptools/_vendor/more_itertools/more.py",
      "line": 3725,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": ").futures.ThreadPoolExecutor(max_workers=1)",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    },
    {
      "file": "services/accessibility-service/~/.cache/uv/archive-v0/_Q-lFynO6L1YN83GdJ5k9/uvicorn/middleware/wsgi.py",
      "line": 89,
      "type": "thread_pool_executor",
      "description": "ThreadPoolExecutor用于CPU密集型任务，受GIL限制",
      "current_code": "self.executor = concurrent.futures.ThreadPoolExecutor(max_workers=workers)",
      "performance_impact": "高影响：可能损失60-80%的多核性能"
    }
  ],
  "optimization_recommendations": {
    "phase_1_immediate": {
      "description": "立即优化（1-2周）",
      "targets": [
        "替换AI推理服务中的ThreadPoolExecutor为ProcessPoolExecutor",
        "优化缓存管理器使用异步I/O",
        "修复高优先级GIL瓶颈"
      ],
      "affected_files": 52,
      "estimated_performance_gain": "30-50%"
    },
    "phase_2_systematic": {
      "description": "系统优化（1个月）",
      "targets": [
        "重构数据处理管道使用多进程",
        "实施Numba JIT编译优化",
        "完善异步I/O使用"
      ],
      "affected_files": 37,
      "estimated_performance_gain": "50-80%"
    },
    "phase_3_advanced": {
      "description": "高级优化（2-3个月）",
      "targets": [
        "开发关键算法的C扩展",
        "微服务架构调整",
        "性能监控系统完善"
      ],
      "estimated_performance_gain": "80-200%"
    }
  }
}